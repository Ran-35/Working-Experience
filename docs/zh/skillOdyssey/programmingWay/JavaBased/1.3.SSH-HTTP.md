### SSHæœåŠ¡å™¨éƒ¨ç½² ä¸ HTTPæ–‡ä»¶ä¸‹è½½

#### 1. SSHè¿æ¥æœåŠ¡å™¨
ğŸ‘‰ é€šè¿‡SSHè¿œç¨‹è¿æ¥æœåŠ¡å™¨ã€‚  

##### (1)SSHJæ–¹å¼
**ä½¿ç”¨æ­¥éª¤**
* (1) æ·»åŠ Mavenä¾èµ–  
```xml
<dependency>
    <groupId>com.hierynomus</groupId>
    <artifactId>sshj</artifactId>
    <version>0.38.0</version>
</dependency>
```
* (2) ä»£ç å®ç°
```java
// ä½¿ç”¨ try-with-resources æ¥è‡ªåŠ¨å…³é—­ SSHClient
try (SSHClient ssh = new SSHClient()) {
    
    // è®¾ç½®è¿æ¥è¶…æ—¶ä¸º 30 ç§’
    ssh.setConnectTimeout(30000);
    
    // è®¾ç½®å…¶ä»–æ“ä½œçš„è¶…æ—¶ä¸º 30 ç§’
    ssh.setTimeout(30000);
    
    // æ·»åŠ  HostKey éªŒè¯å™¨ï¼Œè¿™é‡Œä½¿ç”¨ PromiscuousVerifierï¼Œè¡¨ç¤ºä¸éªŒè¯ SSH ä¸»æœºå¯†é’¥
    ssh.addHostKeyVerifier(new PromiscuousVerifier());
    
    // è¿æ¥åˆ°æŒ‡å®šçš„ IP åœ°å€
    ssh.connect("192.168.1.1");
    
    // ä½¿ç”¨æŒ‡å®šçš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯
    ssh.authPassword("username", "password");
    
    // ä½¿ç”¨ try-with-resources å¯åŠ¨ä¸€ä¸ªä¼šè¯ï¼Œå¹¶ç¡®ä¿ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨å…³é—­
    try (Session session = ssh.startSession()) {
        
        // æ‰§è¡Œ shell å‘½ä»¤ "ls -l"ï¼Œåˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡ä»¶ä¿¡æ¯
        final Session.Command cmd = session.exec("ls -l");
        
        // ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæ¯•
        cmd.join();
    }

    // ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹è·¯å¾„
    ssh.newSCPFileTransfer().upload(new FileSystemFile(localFilePath), remoteFilePath);

    // ä¸‹è½½è¿œç¨‹æ–‡ä»¶åˆ°æœ¬åœ°è·¯å¾„
    ssh.newSCPFileTransfer().download(remoteFilePath, new FileSystemFile(localFileDownloadPath));
}

```

##### (2)Apache MINA SSHD
**ä½¿ç”¨æ­¥éª¤**
* (1) æ·»åŠ Mavenä¾èµ–  
```xml
<dependency>
    <groupId>org.apache.sshd</groupId>
    <artifactId>sshd-core</artifactId>
    <version>2.13.0</version>
</dependency>
<dependency>
    <groupId>org.apache.sshd</groupId>
    <artifactId>sshd-sftp</artifactId>
    <version>2.13.0</version>
</dependency>
```
* (2) ä»£ç ä¸­ä½¿ç”¨ä½œä¸ºå®¢æˆ·ç«¯
```java
// 1. åˆ›å»ºå¹¶å¯åŠ¨å®¢æˆ·ç«¯
try (SshClient client = SshClient.setUpDefaultClient()) {
    client.start();
    
    // 2. å»ºç«‹ä¼šè¯
    try (ClientSession session = client.connect("username", "192.168.1.1", 22)
            .verify(10000).getSession()) {
        
        // 3. èº«ä»½éªŒè¯
        session.addPasswordIdentity("password");
        session.auth().verify(10000);

        // 4. æ‰§è¡Œå‘½ä»¤
        ByteArrayOutputStream responseStream = new ByteArrayOutputStream();
        try (ChannelExec channel = session.createExecChannel("ls -l")) {
            channel.setOut(responseStream);
            channel.open().verify(10000);
            
            // ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæˆ
            channel.waitFor(java.util.EnumSet.of(org.apache.sshd.client.channel.ClientChannelEvent.CLOSED), 0);
            System.out.println("Command Output: " + responseStream.toString());
        }


        String localFilePath = "path/to/local/file.txt";
        String remoteFilePath = "/remote/path/file.txt";
        // 5. æ–‡ä»¶ä¸Šä¼ 
        File localFile = new File(localFilePath);
        try (ScpClient scpClient = session.createScpClient()) {
            scpClient.upload(localFile, remoteFilePath);
        }
        
        // 6. æ–‡ä»¶ä¸‹è½½
        try (ScpClient scpClient = session.createScpClient()) {
            scpClient.download(remoteFilePath, new File(localDownloadPath));
        }
    }
}
```
* (3) ä»£ç ä¸­ä½¿ç”¨ä½œä¸ºæœåŠ¡å™¨(åˆ«äººé€šè¿‡æ§åˆ¶å°ï¼ˆå¦‚ PuTTY æˆ– ssh å‘½ä»¤ï¼‰ç™»å½•åˆ°ä½ çš„ Java åº”ç”¨ä¸­)
```java
SshServer sshd = SshServer.setUpDefaultServer();

// 1. ç«¯å£ä¸å¯†é’¥é…ç½®
sshd.setPort(2222);
sshd.setKeyPairProvider(new SimpleGeneratorHostKeyProvider(new File("hostkey.ser").toPath()));

// 2. å¯†ç è®¤è¯é€»è¾‘
sshd.setPasswordAuthenticator((username, password, session) -> 
    "admin".equals(username) && "123456".equals(password));

// 3. è®¾ç½®ç™»å½•åæ‰§è¡Œçš„ Shellï¼ˆä¾‹å¦‚ç›´æ¥æ˜ å°„åˆ°æœ¬åœ°æ“ä½œç³»ç»Ÿçš„ Shellï¼‰
sshd.setShellFactory(new ProcessShellFactory("/bin/sh", "-i"));

// 4. å¯åŠ¨æœåŠ¡å™¨
sshd.start();
System.out.println("SSH Server started on port 2222...");

// ä¿æŒä¸»çº¿ç¨‹è¿è¡Œ
Thread.sleep(Long.MAX_VALUE);
```
##### (3) ä¸¤ç§æ–¹å¼å¯¹æ¯”
| ç‰¹æ€§         | SSHJ          | Apache SSHD   |
|--------------|---------------|---------------|
| æ˜“ç”¨æ€§       | ä¼˜ç§€          | ä¸€èˆ¬ (é…ç½®ç•¥å¤æ‚)  |
| æ€§èƒ½         | è‰¯å¥½          | æä½³ (åŸºäº NIO)  |
| ç»´æŠ¤çŠ¶æ€     | æ´»è·ƒ          | æ´»è·ƒ (Apache é¡¶çº§é¡¹ç›®) |
| ä¸»è¦ç”¨é€”     | ç°ä»£å®¢æˆ·ç«¯ã€SFTP | é«˜æ€§èƒ½å®¢æˆ·ç«¯ã€è‡ªå®šä¹‰ SSH æœåŠ¡ç«¯ |

-------
#### 2. HTTPä¸‹è½½æ–‡ä»¶  

##### (1)åŸç”Ÿ Java 8 æ–¹å¼  
* ä¸‹è½½æŒ‡å®š URL åœ°å€çš„æ–‡ä»¶å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°æŒ‡å®šè·¯å¾„  
```java
public void download(){
    // urlä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°ç›®å½•(String savePath = "C:/downloads/generated_file.zip")
    String fileUrl = "https://example.com/file.zip";
    String savePath = "C:/downloads/file.zip";

    try (InputStream in = new URL(fileUrl).openStream()) {
        Files.copy(in, Paths.get(savePath), StandardCopyOption.REPLACE_EXISTING);
        System.out.println("ä¸‹è½½å®Œæˆï¼");
    } catch (Exception e) {
        e.printStackTrace();
    } 
}
```
##### (2)å¢å¼ºç‰ˆåŸç”Ÿ Java 8ï¼ˆå¸¦è¶…æ—¶æ§åˆ¶ï¼‰
```java
public void download(){
    // urlä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°ç›®å½•(String savePath = "C:/downloads/generated_file.zip")
    String fileUrl = "https://example.com/file.zip";
    String savePath = "C:/downloads/file.zip";

    URL url = new URL(fileUrl);
    HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();
    
    // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    httpConn.setConnectTimeout(5000);
    httpConn.setReadTimeout(5000);

    int responseCode = httpConn.getResponseCode();
    if (responseCode == HttpURLConnection.HTTP_OK) {
        try (BufferedInputStream in = new BufferedInputStream(httpConn.getInputStream());
                FileOutputStream fileOutputStream = new FileOutputStream(savePath)) {
            
            byte[] dataBuffer = new byte[1024];
            int bytesRead;
            while ((bytesRead = in.read(dataBuffer, 0, 1024)) != -1) {
                fileOutputStream.write(dataBuffer, 0, bytesRead);
            }
        }
    }
    httpConn.disconnect();
}
```
##### (3)Apache Commons IO
1. Maven ä¾èµ–ï¼š
```xml
<dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.11.0</version>
</dependency>
```
2. ä»£ç ä½¿ç”¨ï¼š
```java
public void download(){
    URL url = new URL("https://example.com/image.png");

    // æœ¬åœ°ä¿å­˜çš„è·¯å¾„
    File destination = new File("image.png");
    
    // è¯¥æ–¹æ³•å†…éƒ¨å·²å¤„ç†æµçš„å…³é—­å’Œè¶…æ—¶
    FileUtils.copyURLToFile(url, destination, 5000, 5000);
}
```

* ä¸‹è½½ä¸´æ—¶ç”Ÿæˆçš„æ–‡ä»¶
##### (4)Spring Boot æ¨èæ–¹å¼ (Resource å°è£…)
```java
@GetMapping("/download")
public ResponseEntity<Resource> downloadFile() throws IOException {
    // å‡è®¾è¿™æ˜¯ä½ ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„
    Path path = Paths.get("/path/to/your/generated_file.xlsx");
    Resource resource = new UrlResource(path.toUri());

    return ResponseEntity.ok()
            .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + resource.getFilename() + "\"")
            .contentType(MediaType.APPLICATION_OCTET_STREAM)
            .body(resource);
}
```
```java
@GetMapping("/download-string")
public ResponseEntity<byte[]> downloadString() {
    // 1. æ–‡ä»¶å†…å®¹æ¥è‡ªï¼šsomeMethodToGenerateString()æ–¹æ³•
    String fileContent = someMethodToGenerateString();
    String fileName = "generated_data.txt";

    // 2. å°† String è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ (æ³¨æ„æŒ‡å®šç¼–ç ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç )
    byte[] contentBytes = fileContent.getBytes(StandardCharsets.UTF_8);

    // 3. æ„å»ºå“åº”å¤´
    HttpHeaders headers = new HttpHeaders();
    // è®¾ç½®ä¸‹è½½æ–‡ä»¶å
    headers.setContentDispositionFormData("attachment", fileName);
    // è®¾ç½®ç±»å‹ä¸ºäºŒè¿›åˆ¶æµ
    headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);

    return new ResponseEntity<>(contentBytes, headers, HttpStatus.OK);
}
```
##### (5)åŸç”Ÿ Servlet æ–¹å¼ (Java 8 åŸºç¡€ç‰ˆ)
```java
public void doGet(HttpServletResponse response) throws IOException {
    File file = new File("/path/to/generated_file.pdf");
    
    // è®¾ç½®å“åº”å¤´
    response.setContentType("application/pdf");
    response.setHeader("Content-Disposition", "attachment; filename=" + file.getName());
    response.setContentLength((int) file.length());

    // ä½¿ç”¨ Java 8 Files.copy å¿«é€Ÿå¯¹æ‹·
    try (InputStream in = new FileInputStream(file)) {
        Files.copy(in, response.getOutputStream());
    }
}
```
```Java
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    // æ–‡ä»¶å†…å®¹æ¥è‡ªsomeMethodToGenerateString()æ–¹æ³•
    String fileContent = someMethodToGenerateString();
    
    // è®¾ç½®å“åº”å¤´
    response.setContentType("text/plain;charset=UTF-8");
    response.setHeader("Content-Disposition", "attachment; filename=\"data.txt\"");
    
    // ç›´æ¥é€šè¿‡ response çš„è¾“å‡ºæµå†™å‡º String
    try (PrintWriter writer = response.getWriter()) {
        writer.write(fileContent);
        writer.flush();
    }
}
```